<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>ml-ol-maps-ng by daveegrant</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>ml-ol-maps-ng</h1>
        <h2>AngularJS directives with OpenLayers Maps integration for use with MarkLogic REST-api.</h2>
        <a href="https://github.com/daveegrant/ml-ol-maps-ng" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>

<p>Includes directives to display MarkLogic search results on a map.</p>
<p>Also includes a directive to display single item on a detailed map.  The detail map directive also supports showing links between items.</p>

<h2>Key Features:</h2>
<ul>
  <li>Show multiple geospatial facets on one map</li>
  <li>Fast display of cluster markers</li>
  <li>Distinctly colored markers per facet</li>
  <li>Mouse interaction:</li>
  <ul>
    <li>Pan and zoom to limit geo search (optional)</li>
    <li>Click on single point markers to show details</li>
  </ul>
</ul>

<h1>
<a id="quickstart" class="anchor" href="#quickstart" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quickstart</h1>

<p>To start using OpenLayers Maps for MarkLogic, follow these steps to get started.</p>

<ol type="1">
  <li>
    <p>Download <a href="https://github.com/daveegrant/ml-ol-maps-ng/blob/master/dist/ml-ol-maps-ng.js">ml-ol-maps-ng</a> (<a href="https://github.com/daveegrant/ml-ol-maps-ng/blob/master/dist/ml-ol-maps-ng.min.js">minified version</a>) and put it with your other scripts.  Alternatively, you can use Bower to install it automatically:</p>

    <div>
      <pre><code>bower install [--save] ml-ol-maps-ng</code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>If using the link analysis portion of the detail map, you can use the default graphSearch and graphExpand functions, which return the node and link data.  To use the default functions, you must install the <a href="https://github.com/daveegrant/map-links">mlpm module</a>.  If you want to create your own, this mlpm module code could be used as a starting point.</p>

    <div>
      <pre><code>
npm install -g mlpm
mlpm install map-links --save
mlpm deploy -H localhost -P 8040 -u admin -p admin</code></pre>
    </div>

    <b>Enable Triple Index</b>
    <p>Since this library works based on SPARQL queries against triples stored in your MarkLogic database, you need to enable the triple index.</p>

  </li>
  <li>
    <p>If using the link analysis portion of the detail map, you can use the default graphSearch and graphExpand functions, which return the node and link data.  To use the default functions, you must install the <a href="https://github.com/daveegrant/map-links">mlpm module</a>.  If you want to create your own, this mlpm module code could be used as a starting point.</p>

    <div>
      <pre><code>
npm install -g mlpm
mlpm install map-links --save
mlpm deploy -H localhost -P 8040 -u admin -p admin</code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Load <code>ol.js</code>, <code>angular-openlayers-directive.min.js</code>, <code>ml-ol-maps-ng.js</code> and <code>ml-ol-maps-ng-tpls.js</code> into your HTML page (typically in the end of the BODY of your HTML):</p>

    <p><b>Note:</b> The <code>ol.js</code> file must be imported before the others as they are dependent upon the OpenLayers API.</p>

    <div>
      <pre><code>
&lt;script src='/bower_components/openlayers/ol.js'&gt;&lt;/script&gt;
&lt;script src='/bower_components/angular-openlayers-directive/dist/angular-openlayers-directive.min.js'&gt;&lt;/script&gt;
&lt;script src='/bower_components/ml-ol-maps-ng/dist/ml-ol-maps-ng[.min].js'&gt;&lt;/script&gt;
&lt;script src='/bower_components/ml-ol-maps-ng/dist/ml-ol-maps-ng-tpls[.min].js'&gt;&lt;/script&gt;
      </code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Load OpenLayers stylesheet along with the <code>ml-ol-maps-ng.css</code> into your HTML page (typically in the end of the HEAD of your HTML):</p>

    <div>
      <pre><code>
&lt;link rel="stylesheet" href="/bower_components/ml-ol-maps-ng/dist/ml-ol-maps-ng.css" /&gt;
&lt;link rel="stylesheet" href="/bower_components/openlayers/ol.css" /&gt;
      </code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Update your application module to depend on the <code>openlayers-directive</code>, <code>ml.ol-maps</code> and <code>ml.ol-maps.tpls</code> modules:</p>

    <div>
      <pre><code>angular.module('myApplicationModule', ['openlayers-directive', 'ml.ol-maps', 'ml.ol-maps.tpls']);</code></pre>
    </div>

    <p></p>
  </li>
</ol>

<h1>
<a id="directives" class="anchor" href="#directives" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Directives</h1>

<ul>
  <li><a href="#ml-ol-search-facets-map">ml-ol-search-facets-map</a></li>
  <li><a href="#ml-ol-search-feature-map">ml-ol-search-feature-map</a></li>
  <li><a href="#ml-ol-detail-map">ml-ol-detail-map</a></li>
</ul>

<h2>
<a id="ml-ol-search-facets-map" class="anchor" href="#ml-ol-search-facets-map" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ml-ol-search-facets-map</h2>

<h3>Description:</h3>

<p>The <code>ml-ol-search-facets-map</code> directive utilizes geospatial facet data to draw cluster markers on  the map.  The geospatial facet data is expected to have a box coordinates along with the count for the number of items contained in the box.  When the facets data has multiple geospatial facets, each facet gets a unique color for the cluster markers (up to 5 different colors).</p>

<h3>Attributes:</h3>

<ul>
  <li>
    <code>facets</code> (<b>required</b>): The JSON object containing the facets to be used to create data on the map.
  </li>
  <li>
    <code>base-map</code> (<i>optional</i>): The JSON object containing the definition of the base map.  If not specified, the default base map is Open Street Map.
  </li>
  <li>
    <code>zoom</code> (<i>optional</i>): A number indicating the zoom level.  If not specified, the default is 5.
  </li>
  <li>
    <code>bounds-changed</code> (<i>optional</i>): The callback function reference when the bounds of the map are changed.  
  </li>
  <li>
    <code>single-click</code> (<i>optional</i>): The callback function reference when the map is single clicked.  When a feature (point) is clicked on the map, the feature URI is the function parameter.
  </li>
</ul>

<h3>Example:</h3>

<p>To use the <code>ml-ol-search-facets-map</code> directive, you must first follow the steps in the <a href="#quickstart">Quickstart</a> section to prepare your application.  Then follow the steps below:</p>

<ol type="1">
  <li>
    <p>Expose objects and call-back functions in your Angular controller:</p>

    <div>
      <pre><code>MyCtrl.$inject = ['$scope'];
function MyCtrl($scope) {
  var ctrl = this;

  var ctrl.mapOptions = {
    zoom: 10,
    baseMap: {
      name: 'Esri Maps',
      source: {
        type: 'EsriBaseMaps',
        layer: 'NatGeo_World_Map'
      }
    }
  };

  ctrl.myFacets = {
    facets: {
      locations: {
        boxes: [
          {
            count: 180,
            s: -9.819211,
            w: -38.94669,
            n: -0.08639,
            e: -2.864274
          },
          {
            count: 60,
            s: 0.272045,
            w: -38.15781,
            n: 31.38252,
            e: -0.228349
          },
          {
            count: 53,
            s: 1.871073,
            w: 0.74539,
            n: 31.72132,
            e: 38.02885
          }
        ]
      }
    }
  };

  ctrl.mapBoundsChanged = function(bounds) {
    // place your geospatial search code here, and make that update $scope.myFacets
    //
    // The &lt;bounds&gt; parameter has an object structure like:
    //
    // {
    //    south: 51.0,
    //    west: 4.11,
    //    north: 53.0,
    //    east: 5.25
    // }
    //
  };

  ctrl.mapSingleClick = function(featureUri) {
    // place your code to do something with the clicked feature (e.g. - go to details page)
  };

}</code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Add <code>ml-ol-search-facets-map</code> element in your template:</p>

    <div>
      <pre><code>&lt;ml-ol-search-facets-map facets="ctrl.myFacets.facets" zoom="ctrl.mapOptions.zoom" base-map="ctrl.mapOptions.baseMap" bounds-changed="ctrl.mapBoundsChanged(bounds)" single-click="ctrl.mapSingleClick(featureUri)"&gt;&lt;/ml-ol-search-facets-map&gt;</code></pre>
    </div>

    <p></p>
  </li>
</ol>

<h2>
<a id="ml-ol-search-feature-map" class="anchor" href="#ml-ol-search-feature-map" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ml-ol-search-feature-map</h2>

<h3>Description:</h3>

<p>The <code>ml-ol-search-feature-map</code> directive is used to display individual search results on a map.  Each item to be displayed on the map must be created as a <a href="http://geojson.org/geojson-spec.html#feature-objects">GeoJSON feature object</a>.</p>

<p>It is recommended that the 'properties' property of the feature object is used to store important attributes of the feature.  Specifically, the 'name' and 'uri' properties are used display data on the map.  The 'name' property is used to label the point on the map.  The 'uri' property is used when a point is clicked on the map.</p>

<h3>Attributes:</h3>

<ul>
  <li>
    <code>features</code> (<b>required</b>): The JSON object containing the <a href="http://geojson.org/geojson-spec.html#feature-objects">GeoJSON feature objects</a> to be used to create data on the map.
  </li>
  <li>
    <code>base-map</code> (<i>optional</i>): The JSON object containing the definition of the base map.  If not specified, the default base map is Open Street Map.
  </li>
  <li>
    <code>zoom</code> (<i>optional</i>): A number indicating the zoom level.  If not specified, the default is 5.
  </li>
  <li>
    <code>bounds-changed</code> (<i>optional</i>): The callback function reference when the bounds of the map are changed.  
  </li>
  <li>
    <code>single-click</code> (<i>optional</i>): The callback function reference when the map is single clicked.  When a feature (point) is clicked on the map, the feature URI is the function parameter.
  </li>
</ul>

<h3>Example:</h3>

<p>To use the <code>ml-ol-search-feature-map</code> directive, you must first follow the steps in the <a href="#quickstart">Quickstart</a> section to prepare your application.  Then follow the steps below:</p>

<ol type="1">
  <li>
    <p>Expose objects and call-back functions in your Angular controller:</p>

    <div>
      <pre><code>MyCtrl.$inject = ['$scope'];
function MyCtrl($scope) {
  var ctrl = this;

  var ctrl.mapOptions = {
    zoom: 10,
    baseMap: {
      name: 'OpenStreetMap',
      source: {
        type: 'OSM'
      }
    }
  };

  ctrl.myFeatures = [
    {
      type: 'Feature',
      properties: {
        name: 'Fred Blackstone',
        uri: '/data/fred-blackstone.json'
      },
      geometry: {
        type: 'Point',
        coordinates: [3.999297, 5.676913]
      }
    },
    {
      type: 'Feature',
      properties: {
        name: 'James Gray',
        uri: '/data/james-gray.json'
      },
      geometry: {
        type: 'Point',
        coordinates: [2.019297, 3.136382]
      }
    },
    {
      type: 'Feature',
      properties: {
        name: 'Jason Fitzgerald',
        uri: '/data/jason-fitzgerald.json'
      },
      geometry: {
        type: 'Point',
        coordinates: [5.0297, 6.6382]
      }
    }
  ];

  ctrl.mapBoundsChanged = function(bounds) {
    // place your geospatial search code here, and make that update $scope.myFacets
    //
    // The &lt;bounds&gt; parameter has an object structure like:
    //
    // {
    //    south: 51.0,
    //    west: 4.11,
    //    north: 53.0,
    //    east: 5.25
    // }
    //
  };

  ctrl.mapSingleClick = function(featureUri) {
    // place your code to do something with the clicked feature (e.g. - go to details page)
  };

}</code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Add <code>ml-ol-search-feature-map</code> element in your template:</p>

    <div>
      <pre><code>&lt;ml-ol-search-feature-map features="ctrl.myFeatures" zoom="ctrl.mapOptions.zoom" base-map="ctrl.mapOptions.baseMap" bounds-changed="ctrl.mapBoundsChanged(bounds)" single-click="ctrl.mapSingleClick(featureUri)"&gt;&lt;/ml-ol-search-feature-map&gt;</code></pre>
    </div>

    <p></p>
  </li>
</ol>

<h2>
<a id="ml-ol-detail-map" class="anchor" href="#ml-ol-detail-map" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ml-ol-detail-map</h2>

<h3>Description:</h3>

<p>The <code>ml-ol-detail-map</code> directive is used to display explicit point(s) on a map.  This directive has two attributes (<code>features</code>, <code>geometry</code>) that could be used to display points on the map.  It is recommended that only one of these attributes be used at a time however if both attributes are used, data from each will be displayed on the map.</p>

<p>If using the <code>features</code> attribute, the data must be created as a <a href="http://geojson.org/geojson-spec.html#feature-objects">GeoJSON feature object</a>.  It is recommended that the 'properties' property of the feature object is used to store important attributes of the feature.  Specifically, the 'name' and 'uri' properties are used display data on the map.  The 'name' property is used to label the point on the map.  The 'uri' property is used when a point is clicked on the map.</p>

<p>The <code>ml-ol-detail-map</code> directive has the ability to display links between the default node by calling a service to get link data.  The <code>enable-links</code> attribute is used to activate the displaying of links.  When active, a node can be double-clicked to invoke the service to get linked data.  When the <code>enable-properties-view</code> attribute is activated, a single-click on a node on the map will display the metadata for that point.</p>

<h3>Attributes:</h3>

<ul>
  <li>
    <code>features</code> (<b>required</b>): The JSON object containing the <a href="http://geojson.org/geojson-spec.html#feature-objects">GeoJSON feature object(s)</a> to be used to create data on the map.
  </li>
  <li>
    <code>geometry</code> (<b>required</b>): The array of coordinates is used to create data on the map.  For the coordinate arrays, the longitude is first followed by the latitude.  An example of two points is: <code>[[52.3881895, 4.8447237], [52.388, 9.844]]</code>.
  </li>
  <li>
    <code>base-map</code> (<i>optional</i>): The JSON object containing the definition of the base map.  If not specified, the default base map is Open Street Map.
  </li>
  <li>
    <code>zoom</code> (<i>optional</i>): A number indicating the zoom level.  If not specified, the default is 5.
  </li>
  <li>
    <code>enable-links</code> (<i>optional</i>): A boolean value representing whether link data should be displayed.  If not specified, the default is 'true'.
  </li>
  <li>
    <code>enable-properties-view</code> (<i>optional</i>): A boolean value representing whether feature/point metadata should be displayed when single-clicked.  If not specified, the default is 'true'.
  </li>
  <li>
    <code>groups</code> (<i>optional</i>): An array of objects that specify colors for groups of data when link data is shown.  The 'group' property of the feature/point is used to determine the color used to represent it on the map.  If not specified, the default color (red) is used for all nodes.
  </li>
  <li>
    <code>single-click</code> (<i>optional</i>): The callback function reference when the map is single-clicked.  When a feature (point) is clicked on the map, the feature URI is the function parameter.
  </li>
  <li>
    <code>double-click</code> (<i>optional</i>): The callback function reference when the map is double-clicked.  When a feature (point) is clicked on the map, the feature URI is the function parameter.
  </li>
</ul>

<h3>Example:</h3>

<p>To use the <code>ml-ol-detail-map</code> directive, you must first follow the steps in the <a href="#quickstart">Quickstart</a> section to prepare your application.  Then follow the steps below:</p>

<ol type="1">
  <li>
    <p>Expose objects and call-back functions in your Angular controller:</p>

    <div>
      <pre><code>MyCtrl.$inject = ['$scope'];
function MyCtrl($scope) {
  var ctrl = this;

  var ctrl.mapOptions = {
    zoom: 10,
    baseMap: {
      name: 'OpenStreetMap',
      source: {
        type: 'OSM'
      }
    },
    groups: [
      { name: 'http://xmlns.com/foaf/0.1/Person', color: 'blue'},
      { name: 'http://xmlns.com/foaf/0.1/Organization', color: 'orange'},
    ]
  };

  ctrl.myFeatures = [
    {
      type: 'Feature',
      properties: {
        name: 'Fred Blackstone',
        uri: '/data/fred-blackstone.json',
        group: 'http://xmlns.com/foaf/0.1/Person'
      },
      geometry: {
        type: 'Point',
        coordinates: [3.999297, 5.676913]
      }
    },
    {
      type: 'Feature',
      properties: {
        name: 'James Gray',
        uri: '/data/james-gray.json',
        group: 'http://xmlns.com/foaf/0.1/Person'
      },
      geometry: {
        type: 'Point',
        coordinates: [2.019297, 3.136382]
      }
    },
    {
      type: 'Feature',
      properties: {
        name: 'Jason Fitzgerald',
        uri: '/data/jason-fitzgerald.json',
        group: 'http://xmlns.com/foaf/0.1/Person'
      },
      geometry: {
        type: 'Point',
        coordinates: [5.0297, 6.6382]
      }
    },
    {
      type: 'Feature',
      properties: {
        name: 'Acme',
        uri: '/data/acme.json',
        group: 'http://xmlns.com/foaf/0.1/Organization'
      },
      geometry: {
        type: 'Point',
        coordinates: [4.0970, 6.6382]
      }
    }
  ];

  ctrl.mapSingleClick = function(featureUri) {
    // place your code to do something with the clicked feature (e.g. - go to details page)
  };

}</code></pre>
    </div>

    <p></p>
  </li>
  <li>
    <p>Add <code>ml-ol-detail-map</code> element in your template:</p>

    <div>
      <pre><code>&lt;ml-ol-detail-map features="ctrl.myFeatures" zoom="ctrl.mapOptions.zoom" base-map="ctrl.mapOptions.baseMap" groups="ctrl.mapOptions.groups" enable-properties-view="false" single-click="ctrl.mapSingleClick(featureUri)"&gt;&lt;/ml-ol-detail-map&gt;</code></pre>
    </div>

    <p></p>
  </li>
</ol>

        </section>

        <aside id="sidebar">
          <a href="https://github.com/daveegrant/ml-ol-maps-ng/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/daveegrant/ml-ol-maps-ng/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/daveegrant/ml-ol-maps-ng"></a> is maintained by <a href="https://github.com/daveegrant">daveegrant</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
